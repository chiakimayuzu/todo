{% extends 'base.html' %}
{% block content %}
   <form method="POST">
      {% csrf_token %}

      <div>
         ã‚¿ã‚¹ã‚¯åï¼š{{ form.title }}  <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
     </div>
     <span id="title_error" style="color:red; display:none;">ã‚¿ã‚¤ãƒˆãƒ«ãŒã™ã§ã«å­˜åœ¨ã—ã¾ã™ã€‚</span>
      <!-- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ(titleç©ºç™½)ãŒdisplay:none -->
      
      <div>
         èª¬æ˜ï¼š{{ form.description }}  <!-- è©³ç´°èª¬æ˜ -->
      </div>
     
      <div>
      æœŸé™ï¼š{{ form.expiry }} 
      <span id="calendar-icon">ğŸ“…</span> <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ -->
      </div>

     <script>
      $(document).ready(function () {
          $(".datepicker").datepicker({
              dateFormat: "yy-mm-dd",
              minDate: 0 // ä»Šæ—¥ä»¥é™ã®æ—¥ä»˜ã®ã¿é¸æŠå¯èƒ½
          });
  
          $("#calendar-icon").click(function () {
              $(".datepicker").focus(); // ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
          });
      });
  </script>
      
      <input type="submit" value="ã‚¿ã‚¹ã‚¯ç™»éŒ²">

      <div>
      <a class="navbar-brand" href="{% url 'todo:task_list' %}">æˆ»ã‚‹</a>
      </div>
   </form>

   <script>
   document.getElementById('id_title').addEventListener('input', function() {
      var title = this.value;
      
      if (title) {
            // ã‚µãƒ¼ãƒãƒ¼ã«ã‚¿ã‚¤ãƒˆãƒ«ã®é‡è¤‡ã‚’ç¢ºèªã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
         fetch(`/todo/check_title/?title=${encodeURIComponent(title)}`)
                 // check_titleã§views.pyã®é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹
                 //ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ãŸã‚¿ã‚¤ãƒˆãƒ«ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ã£ã¦ã€ãã®ã‚¿ã‚¤ãƒˆãƒ«ãŒã™ã§ã«å­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªã™ã‚‹
                 //encodeURIComponentã¯htmlã¨ã—ã¦é©åˆ‡ãªå½¢ã«titleã‚’å¤‰æ›ã™ã‚‹ã¨ã„ã†æ„å‘³
                 //ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã¯webã‚µãƒ¼ãƒãƒ¼ã«æƒ…å ±ã‚’ä¼ãˆã‚‹ãŸã‚ã«URLã«ä»˜åŠ ã™ã‚‹æ–‡å­—åˆ—
                 //åŸºæœ¬æ§‹é€ ã¯ã€Œ?ã€+ã€Œå¤‰æ•°å(title)ã€+ã€Œ=ã€+ã€Œå¤‰æ•°ã®å€¤ã€ã§ã€è¤‡æ•°ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯ã€Œ&ã€ã§ã¤ãªã’ã‚‹
               .then(response => response.json())  // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¿”ã£ã¦ããŸãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã«å¤‰æ›ã—ã¦ã€æ¬¡ã®å‡¦ç†ã«æ¸¡ã™
               .then(data => { //ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰è¿”ã£ã¦ããŸãƒ‡ãƒ¼ã‚¿ï¼ˆdataï¼‰ã‚’ä½¿ã£ã¦ã€ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã®å‡¦ç†ã‚’ã™ã‚‹//
                  const errorSpan = document.getElementById('title_error');
                  //ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®HTMLè¦ç´ ã‚’å–å¾—ã—ã¦å¤‰æ•°ã«ä¿å­˜ã™ã‚‹//
      
                     // ã‚µãƒ¼ãƒãƒ¼ãŒ `data.exists` ã‚’ True ã§è¿”ã—ãŸå ´åˆï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãŒé‡è¤‡ã—ã¦ã„ã‚‹ï¼‰
                  if (data.exists) {
                        errorSpan.style.display = 'block';} // existsãŒtrue(åŒä¸€ãƒ‡ãƒ¼ã‚¿æœ‰)ãªã‚‰ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
                     else{ 
                        errorSpan.style.display = 'none';}  // ã‚¨ãƒ©ãƒ¼éè¡¨ç¤º
                     
                  })
                  .catch(error => console.error('Error:', error));  // ã‚¨ãƒ©ãƒ¼å‡¦ç†
         }
      });
      </script>
      
   {% endblock %}